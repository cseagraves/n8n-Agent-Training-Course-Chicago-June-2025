name: Convert README to PDF

permissions:
  contents: write

on:
  push:
    branches: [ main, master ]
    paths: [ 'README.md' ]
  workflow_dispatch:

jobs:
  convert-to-pdf:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Convert README to PDF using markdown-to-pdf action
      uses: baileyjm02/markdown-to-pdf@v1
      with:
        input_path: README.md
        output_dir: ./
        images_dir: Images
        image_import: ./Images
        build_html: false
        build_pdf: true
        theme: |
          body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            color: #24292f;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
          }
          
          /* Enhanced emoji support */
          .emoji, span[role="img"] {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", "Android Emoji", "EmojiSymbols";
            font-size: 1.1em;
            vertical-align: baseline;
          }
          
          /* Remove extra spacing at top */
          body > *:first-child {
            margin-top: 0 !important;
            padding-top: 0 !important;
          }
          
          h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
          }
          
          h1 { 
            border-bottom: 1px solid #d0d7de; 
            padding-bottom: .3em;
            font-size: 2em;
          }
          
          h2 { 
            border-bottom: 1px solid #d0d7de; 
            padding-bottom: .3em;
            font-size: 1.5em;
          }
          
          h3 { font-size: 1.25em; }
          h4 { font-size: 1em; }
          
          /* Better spacing for instructor section */
          div[align="center"] {
            text-align: center;
            margin: 20px 0;
          }
          
          /* Image styling */
          img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 10px 0;
          }
          
          /* Code styling */
          code {
            padding: .2em .4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(175,184,193,0.2);
            border-radius: 6px;
          }
          
          pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
            margin: 16px 0;
          }
          
          /* Quote styling */
          blockquote {
            padding: 0 1em;
            color: #656d76;
            border-left: .25em solid #d0d7de;
            margin: 16px 0;
          }
          
          /* Table styling */
          table {
            border-spacing: 0;
            border-collapse: collapse;
            margin: 16px 0;
            width: 100%;
          }
          
          table th, table td {
            padding: 6px 13px;
            border: 1px solid #d0d7de;
          }
          
          table th {
            font-weight: 600;
            background-color: #f6f8fa;
          }
          
          /* List styling */
          ul, ol {
            margin: 16px 0;
            padding-left: 2em;
          }
          
          li {
            margin: 4px 0;
          }
          
          /* Link styling */
          a {
            color: #0969da;
            text-decoration: none;
          }
          
          a:hover {
            text-decoration: underline;
          }
          
          /* Horizontal rule */
          hr {
            height: 2px;
            background-color: #d0d7de;
            border: 0;
            margin: 24px 0;
          }
          
          /* Paragraph spacing */
          p {
            margin: 16px 0;
          }
          
          /* Strong text */
          strong {
            font-weight: 600;
          }
          
          /* Emphasis */
          em {
            font-style: italic;
          }

    - name: Rename PDF to final name
      run: |
        if [ -f "README.pdf" ]; then
          mv README.pdf AI-Agent-Real-Estate-Workshop-Guide.pdf
          echo "‚úÖ PDF renamed successfully"
        else
          echo "‚ùå README.pdf not found"
          ls -la *.pdf || echo "No PDF files found"
          exit 1
        fi

    - name: Check if PDF was created successfully
      run: |
        if [ -f "AI-Agent-Real-Estate-Workshop-Guide.pdf" ]; then
          echo "‚úÖ PDF successfully created"
          ls -la "AI-Agent-Real-Estate-Workshop-Guide.pdf"
          echo "üìä PDF file size: $(du -h AI-Agent-Real-Estate-Workshop-Guide.pdf | cut -f1)"
        else
          echo "‚ùå PDF creation failed"
          echo "Available files:"
          ls -la
          exit 1
        fi

    - name: Commit and push PDF
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"

        # Add the PDF file
        git add "AI-Agent-Real-Estate-Workshop-Guide.pdf"

        # Check if there are changes to commit
        if git diff --staged --quiet; then
          echo "No changes to commit - PDF is already up to date"
        else
          git commit -m "üìÑ Auto-update: Convert README to PDF [skip ci]"
          git push
          echo "‚úÖ PDF committed and pushed successfully"
        fi

    - name: Upload PDF as artifact
      uses: actions/upload-artifact@v4
      with:
        name: workshop-guide-pdf
        path: "AI-Agent-Real-Estate-Workshop-Guide.pdf"
        retention-days: 90